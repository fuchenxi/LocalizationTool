# Xcode 集成说明

## 🎯 核心功能

**双击表格行，直接在已打开的 Xcode 项目中定位到对应行！**

---

## ⭐ 为什么优先使用 Xcode？

### 传统方式的问题
使用 `xed -l 12 file.strings` 命令会：
- ❌ 打开一个新的 Xcode 窗口
- ❌ 文件独立显示，脱离项目上下文
- ❌ 需要手动切换回原来的 Xcode 窗口
- ❌ 工作流被打断

### AppleScript 方式的优势
使用 AppleScript 集成：
- ✅ **在已打开的 Xcode 窗口中打开**
- ✅ **保持项目上下文**
- ✅ **无缝工作流**
- ✅ **自动跳转到指定行**

---

## 🔄 工作流程

### 1. 准备工作
```
打开 Xcode 项目
    ↓
启动本工具
    ↓
扫描重复项
```

### 2. 双击跳转
```
双击表格中的某一行
    ↓
Xcode 窗口自动激活
    ↓
在当前项目中打开对应文件
    ↓
自动跳转到第 X 行
    ↓
立即查看上下文
```

### 3. 对比和决策
```
查看第一个重复项（例如第 12 行）
    ↓
返回工具
    ↓
双击第二个重复项（例如第 935 行）
    ↓
对比两个值的差异
    ↓
决定保留哪个
```

### 4. 确认删除
```
返回工具
    ↓
点击"确认删除重复项"
    ↓
只删除重复的行，保留最后一个
    ↓
在 Xcode 中查看 Git diff
    ↓
确认只删除了重复行
```

---

## 🛠️ 技术实现

### AppleScript 代码
```applescript
tell application "Xcode"
    activate                    -- 激活 Xcode
    open "/path/to/file.strings"  -- 打开文件
    
    -- 等待文件打开
    delay 0.5
    
    -- 跳转到指定行
    tell application "System Events"
        keystroke "l" using {command down}  -- Cmd+L 打开"跳转到行"
        delay 0.2
        keystroke "12"                      -- 输入行号
        delay 0.1
        keystroke return                    -- 确认跳转
    end tell
end tell
```

### 降级策略
如果 AppleScript 失败（超时或错误），会自动降级到：
1. 使用 `xed -l <line> <file>` 命令
2. 如果 Xcode 未安装，尝试 VSCode
3. 如果都没有，使用系统默认方式打开

---

## 📊 实际效果

### 场景：查看重复的 "action_cancel"

#### 第一步：双击第一个重复项
```
表格显示：
┌──────────────────────────────────────┐
│ action_cancel  Cancel    12    2    │ ← 双击这里
│ action_cancel  取消      935        │
└──────────────────────────────────────┘

Xcode 中显示（第 12 行）：
   11| // Button titles
   12| "action_cancel" = "Cancel";  ← 光标在这里
   13| "action_ok" = "OK";
```

#### 第二步：双击第二个重复项
```
表格显示：
┌──────────────────────────────────────┐
│ action_cancel  Cancel    12    2    │
│ action_cancel  取消      935        │ ← 双击这里
└──────────────────────────────────────┘

Xcode 中显示（第 935 行）：
   934| //<!-- ========== 1.1.0 新增 ========== -->
   935| "action_cancel" = "取消";  ← 光标在这里
   936| "new_feature" = "新功能";
```

#### 分析
- 第 12 行是英文 "Cancel"
- 第 935 行是中文 "取消"（1.1.0 版本新增）
- **应该保留第 935 行**（最新的中文版本）
- 删除第 12 行的旧英文版本

---

## 💡 使用技巧

### 1. 保持 Xcode 打开
工作时保持 Xcode 项目打开，这样双击跳转时：
- 更快（不需要启动 Xcode）
- 保持上下文（在项目中查看）
- 可以立即编辑（如果需要）

### 2. 对比注释
通过双击查看每个重复项周围的注释，帮助判断：
- 哪个是最新的？
- 哪个有版本号标记？
- 哪个有更详细的说明？

### 3. 快速验证
删除重复项后：
- 在 Xcode 中查看 Git diff
- 确认只删除了重复行
- 确认保留的是正确的值

### 4. 跨语言对比
切换不同语言的 Tab：
- 双击英文的重复项
- 双击中文的重复项
- 对比翻译是否一致

---

## ⚙️ 权限说明

### 首次使用
首次双击时，macOS 可能会提示：
```
"Python" 想要控制 "Xcode"
是否允许？
```

**请点击"允许"**，这样才能使用 AppleScript 控制 Xcode。

### 为什么需要权限？
- AppleScript 需要权限来激活 Xcode
- 需要权限来模拟键盘输入（Cmd+L 跳转）
- 这是 macOS 的安全机制

### 安全说明
- 权限只用于打开文件和跳转
- 不会修改任何文件
- 不会执行其他操作
- 完全透明和安全

---

## 🔍 故障排除

### 双击后 Xcode 没反应
**原因**：可能是权限问题

**解决**：
1. 打开"系统偏好设置" → "安全性与隐私"
2. 点击"隐私" → "自动化"
3. 找到"Python"，勾选"Xcode"

### 跳转到了错误的行
**原因**：可能是延迟不够

**解决**：这是极少数情况，通常会自动重试

### Xcode 打开了新窗口
**原因**：AppleScript 失败，降级到 `xed` 命令

**解决**：检查上面的权限设置

---

## 🎯 总结

通过 AppleScript 集成 Xcode，实现了：
- ✅ **无缝工作流**：不离开当前 Xcode 窗口
- ✅ **快速定位**：自动跳转到指定行
- ✅ **上下文保持**：在项目中查看文件
- ✅ **高效对比**：快速查看不同重复项

**这是专为 iOS 开发者优化的功能！** 🚀

